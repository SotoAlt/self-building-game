<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Chaos Arena</title>

  <!-- Open Graph / Twitter Card -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Chaos Arena">
  <meta property="og:description" content="An AI agent builds the game live. You just try to survive.">
  <meta property="og:image" content="https://chaos.waweapps.win/og-image.png">
  <meta property="og:url" content="https://chaos.waweapps.win">
  <meta name="twitter:card" content="summary_large_image">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

</head>
<body>
  <div id="login-screen">
    <!-- Phase 1: Loading splash (visible by default) -->
    <div id="login-splash" class="login-container">
      <h1>Chaos Arena</h1>
      <p class="login-subtitle">The Chaos Magician awaits...</p>
      <div class="login-loader">
        <div class="loader-spinner"></div>
        <p class="login-status">Loading...</p>
      </div>
    </div>
    <!-- Phase 2: Login buttons (hidden until ready) -->
    <div id="login-buttons-container" class="login-container" style="display:none">
      <h1>Chaos Arena</h1>
      <p class="login-subtitle">The Chaos Magician awaits...</p>
      <div class="login-buttons">
        <button id="btn-continue" class="login-btn continue" style="display:none">Continue</button>
        <button id="btn-twitter-login" class="login-btn twitter" disabled>
          <span class="btn-spinner"></span> Loading Twitter...
        </button>
        <button id="btn-guest" class="login-btn guest">Play as Guest</button>
      </div>
      <p id="login-status" class="login-status"></p>
      <div class="login-onboarding">
        <h3>How it works</h3>
        <div class="onboard-item">
          <div class="onboard-icon">&#x1F52E;</div>
          <div class="onboard-text"><strong>An AI builds the game live.</strong> The Chaos Magician spawns arenas, obstacles, and mini-games in real-time.</div>
        </div>
        <div class="onboard-item">
          <div class="onboard-icon">&#x1F3AE;</div>
          <div class="onboard-text"><strong>Wait for games to start</strong> or chat <strong>@agent</strong> to ask for things &mdash; "spawn a giant spider", "make lava floor"</div>
        </div>
        <div class="onboard-item">
          <div class="onboard-icon">&#x1F4B0;</div>
          <div class="onboard-text"><strong>Bribe the Magician</strong> with MON tokens on Monad mainnet. Log in with Twitter to get a wallet, then top up with MON.</div>
        </div>
      </div>
    </div>
  </div>
  <div id="arena-lobby" style="display:none">
    <div class="lobby-container">
      <h1>Choose an Arena</h1>
      <p class="lobby-subtitle">Pick your battleground</p>
      <div id="arena-list" class="arena-list"></div>
      <p id="arena-status" class="login-status"></p>
    </div>
  </div>
  <div id="ui" style="display:none">
    <h1>ðŸŽ­ Chaos Arena</h1>
    <div id="stats">
      <div>Entities: <span id="entity-count">0</span></div>
      <div>Players: <span id="player-count">0</span></div>
      <div>Physics: <span id="physics-info">-</span></div>
    </div>
    <div id="entities"></div>
  </div>
  <div id="crosshair"></div>
  <div id="chat-panel" style="display:none">
    <div id="chat-messages"></div>
    <input id="chat-input" placeholder="Chat... (@agent to tag)" maxlength="200" />
  </div>
  <div id="controls" style="display:none">
    <div class="controls-row">
      <div class="control-group">
        <div class="keys-wasd">
          <div><kbd>W</kbd></div>
          <div><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd></div>
        </div>
        <span class="control-label">Move</span>
      </div>
      <div class="control-group">
        <kbd class="key-wide">Space</kbd>
        <span class="control-label">Jump</span>
      </div>
      <div class="control-group">
        <kbd>&#x21E7;</kbd>
        <span class="control-label">Sprint</span>
      </div>
      <div class="control-group">
        <kbd>L</kbd>
        <span class="control-label">Board</span>
      </div>
      <div class="control-group">
        <kbd class="key-wide">Enter</kbd>
        <span class="control-label">Chat</span>
      </div>
      <div class="control-group">
        <kbd>&#x1F5B1;</kbd>
        <span class="control-label">Look</span>
      </div>
    </div>
  </div>
  <div id="toast-container"></div>
  <div id="announcements"></div>
  <div id="game-status" class="lobby">
    <div id="game-status-info">
      <div id="game-phase">LOBBY</div>
      <div id="game-type"></div>
    </div>
    <div id="game-timer"></div>
  </div>
  <div id="score-overlay" style="display:none"></div>
  <div id="curse-timer" style="display:none"></div>
  <div id="checkpoint-display" style="display:none"></div>
  <div id="profile-btn">
    <img id="profile-pfp" src="" alt="">
    <span id="profile-name"></span>
  </div>
  <div id="wallet-panel">
    <div class="wp-header">
      <img id="wp-pfp" src="" alt="">
      <div class="wp-header-info">
        <div id="wp-display-name" class="wp-display-name"></div>
        <div id="wp-username" class="wp-username"></div>
      </div>
    </div>
    <div id="wp-guest-msg" class="wp-guest-msg" style="display:none">
      Login with Twitter to unlock your wallet
    </div>
    <div id="wp-tabs-container" style="display:none">
      <div class="wp-tabs">
        <button class="wp-tab active" data-tab="overview">Overview</button>
        <button class="wp-tab" data-tab="history">History</button>
        <button class="wp-tab" data-tab="fund">Fund</button>
      </div>
      <div id="wp-tab-overview" class="wp-tab-content active">
        <div class="wp-section-label">Wallet</div>
        <div class="wp-wallet-row">
          <span id="wp-address" class="wp-address">Loading...</span>
          <button id="wp-copy" class="wp-copy-btn" title="Copy address">&#x2398;</button>
          <button id="wp-explorer" class="wp-copy-btn" title="View on explorer">&#x2197;</button>
        </div>
        <div class="wp-balance-row">
          <span id="wp-balance" class="wp-balance-value">...</span>
          <span class="wp-balance-label">MON</span>
        </div>
        <div class="wp-network">Monad</div>
      </div>
      <div id="wp-tab-history" class="wp-tab-content">
        <div class="wp-tx-list" id="wp-tx-list">
          <div class="wp-tx-empty">Loading...</div>
        </div>
      </div>
      <div id="wp-tab-fund" class="wp-tab-content">
        <div class="wp-section-label">Fund your wallet</div>
        <div id="wp-fund-address" class="wp-fund-address"></div>
        <div id="wp-fund-hint" class="wp-fund-hint"></div>
      </div>
    </div>
    <div class="wp-actions">
      <button id="wp-export" class="wp-btn export" style="display:none">Export Private Key</button>
      <button id="wp-logout" class="wp-btn logout">Logout</button>
    </div>
  </div>
  <div id="leaderboard-panel">
    <h3>Leaderboard</h3>
    <div id="leaderboard-entries"></div>
  </div>
  <div id="bribe-panel" style="display:none">
    <button id="btn-bribe" class="bribe-btn">Bribe the Magician</button>
    <div id="bribe-balance" class="bribe-balance"></div>
  </div>
  <div id="bribe-modal" style="display:none">
    <div class="bribe-modal-content">
      <div class="bribe-modal-header">
        <h3>Bribe the Magician</h3>
        <button id="bribe-close" class="bribe-modal-close">&times;</button>
      </div>
      <div id="bribe-options-list"></div>
    </div>
  </div>
  <div id="debug-panel" style="display:none">
    <div style="font-weight:bold; margin-bottom:6px;">Debug</div>
    <label style="display:flex; align-items:center; gap:6px; cursor:pointer; font-size:11px;">
      <input type="checkbox" id="toggle-ai"> AI Players
    </label>
    <label style="display:flex; align-items:center; gap:6px; cursor:pointer; font-size:11px; margin-top:4px;">
      <input type="checkbox" id="toggle-agent"> Agent Loop
    </label>
    <div id="debug-info" style="font-size:10px; opacity:0.7; margin-top:6px;"></div>
  </div>
  <div id="spectator-overlay">
    <div id="agent-status">
      <div>Phase: <span id="agent-phase">WELCOME</span></div>
    </div>
    <div id="drama-meter">
      <h4>DRAMA METER</h4>
      <div class="drama-bar"><div id="drama-fill"></div></div>
      <div class="drama-label"><span>Calm</span><span id="drama-value">0</span><span>CHAOS</span></div>
    </div>
    <div id="kill-feed"></div>
  </div>
  <button id="help-btn" title="How to play">? How to Play</button>
  <div id="help-overlay" style="display:none">
    <div class="help-content">
      <div class="help-header">
        <h2>Chaos Arena</h2>
        <p>An AI agent runs the show. You just try to survive.</p>
      </div>
      <div class="help-section">
        <div class="help-section-title">The Concept</div>
        <div class="help-row">
          <div class="help-icon purple">&#x1F52E;</div>
          <div>
            <div class="help-label">The Chaos Magician (AI) builds games live</div>
            <div class="help-desc">It spawns arenas, starts mini-games, casts spells, and reacts to what players do.</div>
          </div>
        </div>
        <div class="help-row">
          <div class="help-icon gold">&#x1F399;</div>
          <div>
            <div class="help-label">Talk to it in chat with @agent</div>
            <div class="help-desc">Ask for anything: "spawn a giant spider", "make it rain fire", "start a race"</div>
          </div>
        </div>
        <div class="help-row">
          <div class="help-icon gold">&#x1F4B0;</div>
          <div>
            <div class="help-label">Bribe the Magician</div>
            <div class="help-desc">Pay MON tokens on Monad mainnet for special favors, buffs, or total chaos. Log in with Twitter to get a wallet.</div>
          </div>
        </div>
      </div>
      <div class="help-section">
        <div class="help-section-title">Gameplay</div>
        <div class="help-row">
          <div class="help-icon green">&#x23F3;</div>
          <div>
            <div class="help-label">Games start automatically</div>
            <div class="help-desc">Wait in the lobby &mdash; a new game starts every ~45 seconds or when the agent decides.</div>
          </div>
        </div>
        <div class="help-row">
          <div class="help-icon red">&#x1F480;</div>
          <div>
            <div class="help-label">Survive, race, collect, or compete</div>
            <div class="help-desc">6 game types: survival, races, collecting, king of the hill, hot potato, and reach-the-goal.</div>
          </div>
        </div>
      </div>
      <div class="help-section">
        <div class="help-section-title">Controls</div>
        <div class="help-row">
          <div class="help-icon purple">&#x2328;</div>
          <div>
            <div class="help-label">WASD move &middot; Space jump &middot; Shift sprint</div>
            <div class="help-desc">Enter to chat &middot; L for leaderboard &middot; Mouse to look around</div>
          </div>
        </div>
      </div>
      <div class="help-dismiss">Click anywhere to close &middot; Press ? anytime to reopen</div>
    </div>
  </div>
  <div id="rotate-overlay">
    <div class="rotate-icon">ðŸ“±</div>
    <p>Rotate to landscape</p>
  </div>
  <div id="privy-root" style="display:none"></div>
  <div id="game"></div>
  <script>
    // Must run BEFORE ES modules load so Privy SDK sees patched fetch.
    // Privy fires analytics_events via fetch â€” the endpoint lacks CORS headers
    // for custom domains. The retry loop blocks transactions.
    (function() {
      var _fetch = window.fetch;
      window.fetch = function() {
        var url = typeof arguments[0] === 'string' ? arguments[0] : (arguments[0] && arguments[0].url);
        if (url && url.indexOf('/analytics_events') !== -1) {
          return Promise.resolve(new Response('{}', { status: 200 }));
        }
        return _fetch.apply(this, arguments);
      };
    })();
  </script>
  <script type="module" src="/src/client/main.js"></script>
</body>
</html>
